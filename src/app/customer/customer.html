<div class="form-container">
  <h2>Add Customer</h2>

  
  <form (ngSubmit)="saveCustomer(customerForm)" #customerForm="ngForm" novalidate>
<div class="customer-type">
  <div>
    <label>Type</label>
    <select [(ngModel)]="customer.type" name="type" required #typeField="ngModel">
      <option value="">--Select--</option>
      <option>Individual</option>
      <option>Non-Individual</option>
    </select>
    </div>
    <div *ngIf="customer.type === 'Non-Individual'">
      <label>Firm Type<span class="text-danger">*</span></label>
      <select [(ngModel)]="customer.FirmType" name="firmType"
      required #firmType="ngModel">
        <option value="">--Select Firm Type--</option>
        <option *ngFor="let fir of Firm " 
        [value]="fir.Id">{{ fir.Value}}</option>
    </select></div>
    </div>

    <h3 class="heading">KYC Documents</h3>
    <div class="kyc-documents">
      <div class="document">
      <div>
        <div><label>Document Type<span class="text-danger">*</span></label></div>
        <div>
          <select [(ngModel)]="CustomerKYCDoc[0].KYC_DocId" name="kycDoc0Id" required #kycDoc0Id="ngModel">
            <option value="">--Select Document Type--</option>
            <option value="6"> Aadhaar Card </option>
            <option value="22"> CKYC ID /O</option>
            <option value="48"> DIN </option>
            <option value="5"> Driving License </option>
            <option value="2"> Electricity Bill </option>
            <option value="28"> Firm Registration No </option>
            <option value="33"> Form-60 </option>
            <option value="29"> GST No </option>
            <option value="49"> MSME Registration </option>
            <option value="42"> OCR Aadhaar </option>
            <option value="7"> Other Photo ID </option>
            <option value="1"> PAN Card </option>
            <option value="3"> Passport Copy </option>
            <option value="21"> Ration Card </option>
            <option value="30"> Tan No. </option>
            <option value="4"> Voter ID Card </option>
          </select>
        </div>
      </div>

      <div>
        <label>Document Number<span class="text-danger">*</span></label>
        <input
          type="text"
          [(ngModel)]="CustomerKYCDoc[0].KYC_DocNumber"
          name="kycDoc0Number"
          placeholder="Document Number"
          required
          #kycDoc0Number="ngModel"
        />
        <div *ngIf="kycDoc0Number.invalid && (kycDoc0Number.dirty || kycDoc0Number.touched)" class="text-danger">
          Document number is required.
        </div>
      </div>
      </div>

     
   <div> <label class="form-label fw-bold">Document Image 1</label> 
    <input type="file" id="kycDoc0File" style="display: none" 
    (change)="onFileSelectedDoc($event)" /> 
    <i class="fa-solid fa-arrow-up-from-bracket fa-2x text-primary" 
    style="cursor: pointer;" 
    (click)="openFilePickerDoc()"></i> 
    <div *ngIf="CustomerKYCDoc[0].KYC_DocFile">
       <img [src]="CustomerKYCDoc[0].KYC_DocFile" alt="Preview" width="100" class="mt-2 rounded" /> 
      </div> </div>
       <div> <label class="form-label fw-bold">Document Image 2</label> 
        <input type="file" id="kycDoc0File" style="display: none" (change)="onFileSelectedDoc($event)" /> 
        <i class="fa-solid fa-arrow-up-from-bracket fa-2x text-primary" style="cursor: pointer;" 
        (click)="openFilePickerDoc()"></i> <div *ngIf="CustomerKYCDoc[0].KYC_DocFile"> <img [src]="CustomerKYCDoc[0].KYC_DocFile" alt="Preview" width="100" class="mt-2 rounded" /> </div> </div> 
</div>
<h3 class="heading">Demographic Information</h3>
  <div class="address"><div><label class="form-label fw-bold">Profile Image</label>
  <input 
    type="file" 
    id="profileImage" 
    style="display: none" 
    (change)="onFileSelected($event)" />
     <i class="fa-solid fa-arrow-up-from-bracket fa-2x text-primary"
     style="cursor: pointer;"
     (click)="openFilePicker()"></i>
  <div *ngIf="profilePreviewUrl">
    <img [src]="profilePreviewUrl" alt="Preview" width="100" class="mt-2 rounded" />
</div>
</div>


      <div>
        <label>First Name<span class="text-danger">*</span></label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_FirstName"
          placeholder="First Name"
          name="customerFirstName"
          required
          #customerFirstName="ngModel"
        />
        <div *ngIf="customerFirstName.invalid && (customerFirstName.dirty || customerFirstName.touched)" class="text-danger">
          First name is required.
        </div>
      </div>

      <div>
        <label>Last Name<span class="text-danger">*</span></label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_LastName"
          name="customerLastName"
          placeholder="Last Name"
          required
          #customerLastName="ngModel"
        />
      </div>

      <div>
        <label>Relation <span class="text-danger">*</span></label>
        <select [(ngModel)]="customer.Customer_Relation_Type" name="relationType" required #relationType="ngModel">
          <option value="">Select</option>
          <option value="C/O">C/O</option>
          <option value="S/O">S/O</option>
          <option value="D/O">D/O</option>
          <option value="W/O">W/O</option>
        </select>
      </div>

      <div>
        <label>Relation First Name<span class="text-danger">*</span></label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_Relation_FirstName"
          name="relationFirstName"
          placeholder="First Name"
          required
          #relationFirstName="ngModel"
        />
      </div>

      <div>
        <label>Relation Last Name<span class="text-danger">*</span></label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_Relation_LastName"
          name="relationLastName"
          placeholder="Last Name"
          required
          #relationLastName="ngModel"
        />
      </div>

      <div>
        <label>Gender <span class="text-danger">*</span></label>
        <select [(ngModel)]="customer.Customer_Gender" name="gender" required #gender="ngModel">
          <option value="">Select</option>
          <option value="M">Male</option>
          <option value="F">Female</option>
        </select>
      </div>
<div>

  <label for="dob">Date of Birth:</label>
<input 
  type="date" 
  id="dob" 
  name="dob" 
  [(ngModel)]="customer.Customer_DOB"
  (change)="calculateAge()" 
  required>
 <div *ngIf="customer.age !== null">
    <small>Age: {{ customer.age }}</small>
  </div>

  <div *ngIf="customer.age !== null && customer.age < 18">
    <small class="text-danger">Customer must be at least 18 years old.</small>
  </div>
</div>

      <div>
        <label>Primary Contact<span class="text-danger">*</span></label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_PhoneNo"
          name="primaryContact"
          placeholder="Primary Contact"
          required
          pattern="^[0-9]{10}$"
          maxlength="10"
          inputmode="numeric"
          #primaryContact="ngModel"
        />
        <div *ngIf="primaryContact.invalid && (primaryContact.dirty || primaryContact.touched)" class="text-danger">
          <div *ngIf="primaryContact.errors?.['required']">Contact is required.</div>
          <div *ngIf="primaryContact.errors?.['pattern']">Contact must be 10 digits.</div>
        </div>
      </div>

      <div>
        <label>WhatsApp No</label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_WhatsAppNo"
          name="whatsappNo"
          placeholder="Whatsapp No"
          pattern="^[0-9]{10}$"
          maxlength="10"
          inputmode="numeric"
          #whatsappNo="ngModel"
        />
      </div>

      <div>
        <label>Alternate No</label>
        <input
          type="text"
          [(ngModel)]="customer.Customer_PhoneNo1"
          name="altContact"
          pattern="^[0-9]{10}$"
           placeholder="Alternate No"
          maxlength="10"
          inputmode="numeric"
          #altContact="ngModel"
        />
      </div>

      <div>
        <label>Email</label>
        <input type="email" [(ngModel)]="customer.Customer_Email" name="email"  placeholder="Email " #email="ngModel" />
      </div>

      <div>
        <label>Other Email</label>
        <input type="email" [(ngModel)]="customer.Customer_Other_Email" name="otherEmail" placeholder="Other Email" #otherEmail="ngModel" />
      </div>

      <div>
        <label>Marital Status<span class="text-danger">*</span></label>
        <select [(ngModel)]="customer.Customer_MaritalStatus" name="maritalStatus" required #maritalStatus="ngModel">
          <option value="">--Select--</option>
          <option value="Married">Married</option>
          <option value="UnMarried">UnMarried</option>
          <option value="Widow">Widow/Widower</option>
          <option value="Divorced">Divorced</option>
          <option value="Separated">Separated</option>
        </select>
      </div>

      <div>
        <label>Customer Religion<span class="text-danger">*</span></label>
        <select [(ngModel)]="customer.Customer_Religion" name="religion" required #religion="ngModel">
          <option value="">--Select--</option>
          <option>Hindu</option>
          <option>Muslim</option>
          <option>Christian</option>
          <option>Sikh</option>
          <option>Other</option>
        </select>
      </div>

      <div>
        <label>Customer Caste<span class="text-danger">*</span></label>
        <select [(ngModel)]="customer.Customer_Cast" name="caste" required #caste="ngModel">
          <option value="">--Select--</option>
          <option value="General">General</option>
          <option value="OBC">OBC</option>
          <option value="SC">SC</option>
          <option value="ST">ST</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div>
        <label>Customer Profile<span class="text-danger">*</span></label>
        <select
          [(ngModel)]="customer.Customer_Profile"
          name="profile"
          required
          #profilefield="ngModel"
          (ngModelChange)="loadCustomercategory($event)"
        >
          <option value="">--Select--</option>
          <option *ngFor="let pro of profile" [value]="pro.Id">{{ pro.Value }}</option>
        </select>
      </div>

      <div>
        <label>Customer Category <span class="text-danger">*</span></label>
        <select
          [(ngModel)]="customer.Customer_Category"
          name="category"
          required
          #category="ngModel"
          (ngModelChange)="loadCustomerSubcategory($event)"
        >
          <option value="">--Select--</option>
          <option *ngFor="let c of catergory" [value]="c.Id">{{ c.Value }}</option>
        </select>
      </div>

      <div>
        <label>Customer Sub-Category <span class="text-danger">*</span></label>
        <select
          [(ngModel)]="customer.Customer_SubCategory"
          name="subcategory"
          required
          #subcategory="ngModel"
          (ngModelChange)="loadCustomerNatureOfWork($event)"
        >
          <option value="">--Select--</option>
          <option *ngFor="let s of subcatergory" [value]="s.Id">{{ s.Value }}</option>
        </select>
      </div>

      <div>
        <label>Nature Of Work<span class="text-danger">*</span></label>
        <select
          [(ngModel)]="customer.Customer_Natureofwork"
          name="natureOfWork"
          required
          #natureOfWork="ngModel"
        >
          <option value="">--Select--</option>
          <option *ngFor="let n of Natureofwork" [value]="n.Id">{{ n.Value }}</option>
        </select>
      </div>

      <div>
        <label>Business Type<span class="text-danger">*</span></label>
        <select [(ngModel)]="customer.BusinessCategory" 
        name="businessCategory" required #businessCategory="ngModel">
          <option value="">--Select--</option>
          <option *ngFor="let bc of BusinessCategory" 
          [value]="bc.Id">{{ bc.Value }}</option>
        </select>
      </div>
    </div>

  
    <div>
      <h3 class="heading">Customer Address</h3>
      <h4 >Present Address:</h4>
      <div class="address1">
        <div class="address">
          <div>
            <label>Address<span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="address.AddressS" name="presentAddress"  placeholder="Address" required #presentAddress="ngModel" />
          </div>

          <div>
            <label>Landmark<span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="address.LandMarkS" name="presentLandmark" placeholder="LandMark" required #presentLandmark="ngModel" />
          </div>

          <div>
            <label>State<span class="text-danger">*</span></label>
            <select
              [(ngModel)]="address.StateIdS"
              name="presentState"
              required
              #presentState="ngModel"
              (ngModelChange)="loadDistricts($event)"
            >
              <option value="">--Select--</option>
              <option *ngFor="let s of states" [value]="s.StateId">{{ s.State_Name }}</option>
            </select>
          </div>

          <div>
            <label>District<span class="text-danger">*</span></label>
            <select
              [(ngModel)]="address.DistrictIdS"
              name="presentDistrict"
              required
              #presentDistrict="ngModel"
              (ngModelChange)="loadTehsils($event)"
            >
              <option value="">--Select--</option>
              <option *ngFor="let d of district" [value]="d.DistrictId">{{ d.District_Name }}</option>
            </select>
          </div>

          <div>
            <label>Tehsil<span class="text-danger">*</span></label>
            <select [(ngModel)]="address.TehsilIdS" name="presentTehsil" required #presentTehsil="ngModel">
              <option value="">--Select--</option>
              <option *ngFor="let t of tehsil" [value]="t.TehsilId">{{ t.Tehsil_Name }}</option>
            </select>
          </div>

          <div>
            <label>Pincode</label>
            <input
              type="text"
              [(ngModel)]="address.PinCodeS"
              name="presentPincode"
              placeholder="Pincode"
              required
              pattern="^[0-9]{6}$"
              maxlength="6"
              #presentPincode="ngModel"
            />
            <div *ngIf="presentPincode.invalid && (presentPincode.dirty || presentPincode.touched)">
              <small class="text-danger" *ngIf="presentPincode.errors?.['required']">Pincode is required.</small>
              <small class="text-danger" *ngIf="presentPincode.errors?.['pattern']">Pincode must be exactly 6 digits.</small>
            </div>
          </div>

          <div>
            <label>No of Living Here<span class="text-danger">*</span></label>
            <input
              type="number"
              [(ngModel)]="address.NoOfLivingS"
              placeholder="No of Living Here"
              name="presentNoOfLiving"
              maxlength="2"
              oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
            />
          </div>

          <div>
            <label>Rent/Own<span class="text-danger">*</span></label>
            <select [(ngModel)]="address.RentOwnS" name="presentRentOwn" required #presentRentOwn="ngModel">
              <option value="">--Select--</option>
              <option>Rent</option>
              <option>Own</option>
            </select>
          </div>

          <div>
            <label>Distance To Branch(KM)<span class="text-danger">*</span></label>
            <input
              type="number"
              [(ngModel)]="address.DistanceBranchS"
              name="presentDistance"
              maxlength="2"
              placeholder="Distance From Branch"
              oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
            />
          </div>

          <div class="communicationaddress">
            <input
              class="box"
              type="checkbox"
              [(ngModel)]="address.IsCommunicationAddress"
              name="presentIsCommunication"
            />
            <label class="communicate">Is This Communication Address<span class="text-danger">*</span></label>
          </div>
        </div>
      </div>

      <h4>Permanent Address:</h4>
     

      <div class="address1">
         <div class="communicationaddress">
        <input
          class="box"
          type="checkbox"
          [(ngModel)]="address.NoOfLivingpermanent"
          (change)="sameAsParmanent()"
          name="copyPresentToPermanent"
        />
        <label>Select if Permanent Address same as Present Address</label>
      </div>
        <div class="address">
          
          <div>
            <label>Address<span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="customerPermanent.Address" placeholder="Address" name="permanentAddress" required #permanentAddress="ngModel" />
          </div>

          <div>
            <label>Landmark<span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="customerPermanent.LandMark" placeholder="LandMark" name="permanentLandmark" required #permanentLandmark="ngModel" />
          </div>

          <div>
            <label>State<span class="text-danger">*</span></label>
            <select
              [(ngModel)]="customerPermanent.StateId"
              name="permanentState"
              required
              #permanentState="ngModel"
              (ngModelChange)="loadDistricts($event)"
            >
              <option value="">--Select--</option>
              <option *ngFor="let s of states" [value]="s.StateId">{{ s.State_Name }}</option>
            </select>
          </div>

          <div>
            <label>District<span class="text-danger">*</span></label>
            <select
              [(ngModel)]="customerPermanent.DistrictId"
              name="permanentDistrict"
              required
              #permanentDistrict="ngModel"
              (ngModelChange)="loadTehsils($event)"
            >
              <option value="">--Select--</option>
              <option *ngFor="let d of district" [value]="d.DistrictId">{{ d.District_Name }}</option>
            </select>
          </div>

          <div>
            <label>Tehsil<span class="text-danger">*</span></label>
            <select [(ngModel)]="customerPermanent.TehsilId" name="permanentTehsil" required #permanentTehsil="ngModel">
              <option value="">--Select--</option>
              <option *ngFor="let t of tehsil" [value]="t.TehsilId">{{ t.Tehsil_Name }}</option>
            </select>
          </div>

          <div>
            <label>Pincode</label>
            <input
              type="text"
              [(ngModel)]="customerPermanent.PinCode"
              name="permanentPincode"
              placeholder="Pincode"
              required
              pattern="^[0-9]{6}$"
              maxlength="6"
              #permanentPincode="ngModel"
            />
            <div *ngIf="permanentPincode.invalid && (permanentPincode.dirty || permanentPincode.touched)">
              <small class="text-danger" *ngIf="permanentPincode.errors?.['required']">Pincode is required.</small>
              <small class="text-danger" *ngIf="permanentPincode.errors?.['pattern']">Pincode must be exactly 6 digits.</small>
            </div>
          </div>

          <div>
            <label>No of Living Here<span class="text-danger">*</span></label>
            <input
              type="number"
              placeholder="No of Living Here"
              [(ngModel)]="customerPermanent.NoOfLiving"
              name="permanentNoOfLiving"
              maxlength="2"
              oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
            />
          </div>

          <div>
            <label>Rent/Own<span class="text-danger">*</span></label>
            <select [(ngModel)]="customerPermanent.RentOwn" name="permanentRentOwn" required #permanentRentOwn="ngModel">
              <option value="">--Select--</option>
              <option>Rent</option>
              <option>Own</option>
            </select>
          </div>

          <div>
            <label>Distance To Branch(KM)<span class="text-danger">*</span></label>
            <input
              type="number"
              [(ngModel)]="customerPermanent.DistanceBranch"
              name="permanentDistance"
              maxlength="2"
              placeholder="Distance From Branch"
              oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
            />
          </div>

          <div class="communicationaddress">
            <input
              class="box"
              type="checkbox"
              [(ngModel)]="customerPermanent.IsCommunicationAddress"
              name="permanentIsCommunication"
            />
            <label class="communicate">Is This Communication Address<span class="text-danger">*</span></label>
          </div>
        </div>
      </div>

      <h4>Work Address:</h4>
      <div class="address1">
        <div class="address" ngModelGroup="workAddress" #workForm="ngModelGroup">
          <div>
            <label>Address<span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="customerWork.AddressW" name="workAddress" placeholder="address" #workAddress="ngModel"  [required]="isWorkAddressFilled()" />
          </div>

          <div>
            <label>Landmark<span class="text-danger">*</span></label>
            <input type="text" [(ngModel)]="customerWork.LandMarkW" name="workLandmark" placeholder="Landmark" #workLandmark="ngModel"  [required]="isWorkAddressFilled()"/>
          </div>

          <div>
            <label>State<span class="text-danger">*</span></label>
            <select
             [required]="isWorkAddressFilled()"
              [(ngModel)]="customerWork.StateIdW"
              name="workState"
              #workState="ngModel"
              (ngModelChange)="loadDistricts($event)"
            >
              <option value="">--Select--</option>
              <option *ngFor="let s of states" [value]="s.StateId">{{ s.State_Name }}</option>
            </select>
          </div>

          <div>
            <label>District<span class="text-danger">*</span></label>
            <select
              [(ngModel)]="customerWork.DistrictIdW"
              name="workDistrict"
               [required]="isWorkAddressFilled()"
               #workDistrict="ngModel"
              (ngModelChange)="loadTehsils($event)"
            >
              <option value="">--Select--</option>
              <option *ngFor="let d of district" [value]="d.DistrictId">{{ d.District_Name }}</option>
            </select>
          </div>

          <div>
            <label>Tehsil<span class="text-danger">*</span></label>
            <select [(ngModel)]="customerWork.TehsilIdW" name="workTehsil"  [required]="isWorkAddressFilled()" #workTehsil="ngModel">
              <option value="">--Select--</option>
              <option *ngFor="let t of tehsil" [value]="t.TehsilId">{{ t.Tehsil_Name }}</option>
            </select>
          </div>

          <div>
            <label>Pincode</label>
            <input
              type="text"
              [(ngModel)]="customerWork.PinCodeW"
              name="workPincode"
              placeholder="Pincode"
              [required]="isWorkAddressFilled()"
              pattern="^[0-9]{6}$"
              maxlength="6"
              #workPincode="ngModel"
            />
            <div *ngIf="workPincode.invalid && (workPincode.dirty || workPincode.touched)">
              <small class="text-danger" *ngIf="workPincode.errors?.['required']">Pincode is required.</small>
              <small class="text-danger" *ngIf="workPincode.errors?.['pattern']">Pincode must be exactly 6 digits.</small>
            </div>
          </div>

          <div>
            <label>No of Living Here<span class="text-danger">*</span></label>
            <input
              type="number"
              [(ngModel)]="customerWork.NoOfLivingW"
              placeholder="No of Living Here"
               [required]="isWorkAddressFilled()"
              name="workNoOfLiving"
              maxlength="2"
              oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
            />
          </div>

          <div>
            <label>Rent/Own<span class="text-danger">*</span></label>
            <select [(ngModel)]="customerWork.RentOwnW" name="workRentOwn"  [required]="isWorkAddressFilled()" #workRentOwn="ngModel">
              <option value="">--Select--</option>
              <option>Rent</option>
              <option>Own</option>
            </select>
          </div>

          <div>
            <label>Distance To Branch(KM)<span class="text-danger">*</span></label>
            <input
              type="number"
              [(ngModel)]="customerWork.DistanceBranchW"
               [required]="isWorkAddressFilled()"
              name="workDistance"
              maxlength="2"
              placeholder="Distance From Branch"
              oninput="if(this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
            />
          </div>

          <div class="communicationaddress">
            <input
              class="box"
              type="checkbox"
               [required]="isWorkAddressFilled()"
              [(ngModel)]="customerWork.IsCommunicationAddressW"
              name="workIsCommunication"
            />
            <label class="communicate">Is This Communication Address<span class="text-danger">*</span></label>
          </div>
        </div>
      </div>
    </div>
    <div></div>

    <div class="btn-container">
      <button class="btn-save" type="submit" [disabled]="customerForm.invalid">
        Save
      </button>
    
      <!-- <div *ngIf="customerForm.invalid" style="color: red; margin-top: 10px;">
        <strong>Form is invalid. Please check:</strong>
        <ul>
          <li *ngIf="typeField.invalid">Type is required</li>
          <li *ngIf="kycDoc0Id.invalid">KYC Document Type is required</li>
          <li *ngIf="kycDoc0Number.invalid">KYC Document Number is required</li>
          <li *ngIf="customerFirstName.invalid">First Name is required</li>
          <li *ngIf="customerLastName.invalid">Last Name is required</li>
          <li *ngIf="relationType.invalid">Relation Type is required</li>
        
        </ul>
      </div> -->
    </div>
  </form>
</div>
